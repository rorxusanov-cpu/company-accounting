<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

{% include "navbar.html" %}

<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2>ðŸ“Š Company</h2>

        <a class="active" href="{{ url_for('dashboard') }}">Dashboard</a>

        {% if session.get("role") == "admin" %}
            <a href="{{ url_for('admin_companies') }}">Kompaniyalar</a>
            <a href="{{ url_for('admin_directors') }}">Direktorlar</a>
            <a href="{{ url_for('admin_expenses') }}">Barcha xarajatlar</a>
            <a href="{{ url_for('admin_reports') }}">Hisobotlar</a>
            <a href="{{ url_for('admin_balances') }}">âž• Balans toâ€˜ldirish</a>
        {% else %}
            <a href="{{ url_for('expenses') }}">Xarajatlar</a>
        {% endif %}

        <a href="{{ url_for('logout') }}">Logout</a>
    </aside>

    <!-- MAIN -->
    <main class="main">

        <h1>Xush kelibsiz ðŸ‘‹</h1>

        {% if warning %}
            <div class="warning">{{ warning }}</div>
        {% endif %}

        <!-- STATS -->
        <section class="stats">
            <a href="{{ url_for('admin_balances') }}" class="card-link">
                <div class="card">
                    <p>Umumiy balans</p>
                    <h2>{{ total_balance }} soâ€˜m</h2>
                </div>
            </a>

            <a href="{{ url_for('admin_expenses_by_company') }}" class="card-link">
                <div class="card">
                    <p>Jami xarajatlar</p>
                    <h2>{{ total_expenses }} soâ€˜m</h2>
                </div>
            </a>

            <div class="card">
                <p>Qoldi</p>
                <h2>{{ profit }} soâ€˜m</h2>
            </div>

            <div class="card">
                <p>Kompaniyalar</p>
                <h2>{{ companies_count }} ta</h2>
            </div>
        </section>

        <!-- CHART -->
        <section class="chart-box">

            <!-- FILTER BAR -->
            <div class="filter-bar">
                <a href="{{ url_for('dashboard', period='day') }}" class="filter-btn">ðŸ“† Bugun</a>
                <a href="{{ url_for('dashboard', period='month') }}" class="filter-btn">ðŸ“… Shu oy</a>
                <a href="{{ url_for('dashboard', period='year') }}" class="filter-btn">ðŸ“Š Shu yil</a>

                <form method="get" class="date-range">
                    <input type="date" name="from">
                    <input type="date" name="to">
                    <button type="submit">ðŸ—“ Oraliq</button>
                </form>
            </div>

            <h3>ðŸ“ˆ Xarajatlar</h3>

            {% if labels and values %}
                <canvas id="lineChart"></canvas>
            {% else %}
                <p>Hozircha maâ€™lumot yoâ€˜q</p>
            {% endif %}
        </section>

    </main>
</div>

{% if labels and values %}
<script>
    const labels = {{ labels | tojson }};
    const values = {{ values | tojson }};

    new Chart(document.getElementById("lineChart"), {
        type: "line",
        data: {
            labels,
            datasets: [{
                label: "Xarajatlar",
                data: values,
                borderColor: "#4f6ef7",
                backgroundColor: "rgba(79,110,247,0.15)",
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endif %}

</body>
</html>

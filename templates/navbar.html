<!-- ===== NAVBAR ===== -->
<div class="navbar">
    <div class="navbar-left">
        <strong class="brand">ğŸ¢ Company Accounting</strong>

        <a href="{{ url_for('dashboard') }}">Bosh sahifa</a>

        {% if session.get("role") == "admin" %}
            <a href="{{ url_for('admin_companies') }}">Kompaniyalar</a>
            <a href="{{ url_for('admin_directors') }}">Direktorlar</a>
            <a href="{{ url_for('admin_expenses') }}">Xarajatlar</a>
        {% else %}
            <a href="{{ url_for('expenses') }}">Xarajatlarim</a>
        {% endif %}
    </div>

    <div class="navbar-right">
        <!-- Notification -->
        <button id="notifBtn" class="icon-btn" title="Bildirishnomalar">ğŸ””</button>

        <!-- Theme -->
        <button id="themeToggle" class="icon-btn" title="Theme">ğŸŒ™</button>

        <!-- User -->
        <span class="user">ğŸ‘¤ {{ session['user'] }}</span>

        <!-- Logout -->
        <a href="{{ url_for('logout') }}" class="logout-btn">Chiqish</a>
    </div>
</div>

<!-- ===== NOTIFICATION DROPDOWN ===== -->
<div class="notif-box" id="notifBox">
    <h4>ğŸ”” Bildirishnomalar</h4>

    <div class="notif-item">ğŸ’¸ Yangi xarajat qoâ€˜shildi</div>
    <div class="notif-item">ğŸ¢ Kompaniya balansi yangilandi</div>
    <div class="notif-item muted">ğŸ“­ Hozircha yangi xabar yoâ€˜q</div>
</div>

<!-- ===== SCRIPTS ===== -->
<script>
/* ================= THEME ================= */
const body = document.body;
const toggle = document.getElementById("themeToggle");

body.classList.add("fade");

const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
const savedTheme = localStorage.getItem("theme");

// LOAD
if (savedTheme === "dark" || (!savedTheme && systemDark)) {
    body.classList.add("dark");
    toggle.textContent = "â˜€ï¸";
}

// TOGGLE
toggle.addEventListener("click", () => {
    body.classList.add("fade");

    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");

    toggle.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
    localStorage.setItem("theme", isDark ? "dark" : "light");

    setTimeout(() => body.classList.remove("fade"), 300);
});

// SYSTEM CHANGE
window.matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", e => {
        if (!localStorage.getItem("theme")) {
            body.classList.toggle("dark", e.matches);
            toggle.textContent = e.matches ? "â˜€ï¸" : "ğŸŒ™";
        }
    });

/* ================= NOTIFICATION ================= */
const notifBtn = document.getElementById("notifBtn");
const notifBox = document.getElementById("notifBox");

notifBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    notifBox.style.display =
        notifBox.style.display === "block" ? "none" : "block";
});

document.addEventListener("click", () => {
    notifBox.style.display = "none";
});
</script>

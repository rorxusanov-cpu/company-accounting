<!-- ===== NAVBAR ===== -->
<div class="navbar">
    <div class="navbar-left">
        <strong class="brand">ğŸ¢ Company Accounting</strong>

        <a href="{{ url_for('dashboard') }}">Bosh sahifa</a>

        {% if session.get("role") == "admin" %}
            <a href="{{ url_for('admin_companies') }}">Kompaniyalar</a>
            <a href="{{ url_for('admin_directors') }}">Direktorlar</a>
            <a href="{{ url_for('admin_expenses') }}">Xarajatlar</a>
        {% else %}
            <a href="{{ url_for('expenses') }}">Xarajatlarim</a>
        {% endif %}
    </div>

    <div class="navbar-right">
        <!-- ğŸ”” Notification -->
        <button id="notifBtn" class="icon-btn" title="Bildirishnomalar">ğŸ””</button>

        <!-- ğŸŒ™ Theme -->
        <button id="themeToggle" class="icon-btn" title="Theme">ğŸŒ™</button>

        <!-- ğŸ‘¤ User -->
        <span class="user">ğŸ‘¤ {{ session.get('user') }}</span>

        <!-- ğŸšª Logout -->
        <a href="{{ url_for('logout') }}" class="logout-btn">Chiqish</a>
    </div>
</div>

<!-- ===== NOTIFICATION DROPDOWN ===== -->
<!-- ===== NOTIFICATION DROPDOWN ===== -->
<div class="notif-box" id="notifBox">
    <h4>ğŸ”” Bildirishnomalar</h4>

    {% if last_expense %}
        <div class="notif-item">
            <div class="notif-msg">{{ last_expense.message }}</div>
            <div class="notif-time">ğŸ•’ {{ last_expense.time }}</div>
        </div>

        <form method="post" action="{{ url_for('clear_notification') }}">
            <button class="notif-clear">ğŸ—‘ Tozalash</button>
        </form>
    {% else %}
        <div class="notif-item muted">ğŸ“­ Hozircha yangi xabar yoâ€˜q</div>
    {% endif %}
</div>


<!-- ===== SCRIPTS ===== -->
<script>
/* ================= THEME ================= */
const body = document.body;
const toggle = document.getElementById("themeToggle");

body.classList.add("fade");

const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
const savedTheme = localStorage.getItem("theme");

// LOAD
if (savedTheme === "dark" || (!savedTheme && systemDark)) {
    body.classList.add("dark");
    toggle.textContent = "â˜€ï¸";
}

// TOGGLE
toggle.addEventListener("click", () => {
    body.classList.add("fade");

    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");

    toggle.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
    localStorage.setItem("theme", isDark ? "dark" : "light");

    setTimeout(() => body.classList.remove("fade"), 300);
});

// SYSTEM CHANGE
window.matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", e => {
        if (!localStorage.getItem("theme")) {
            body.classList.toggle("dark", e.matches);
            toggle.textContent = e.matches ? "â˜€ï¸" : "ğŸŒ™";
        }
    });

/* ================= NOTIFICATION ================= */
const notifBtn = document.getElementById("notifBtn");
const notifBox = document.getElementById("notifBox");

notifBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    notifBox.classList.toggle("show");
});

document.addEventListener("click", () => {
    notifBox.classList.remove("show");
});
</script>
